# 251215 TIL

## MSA Swagger 적용

### 1. 로컬 코드 수정 (각 마이크로서비스)

**대상:** `개별 service`

1. 의존성 추가(`build.gradle`)
```groovy
dependencies {
    implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.3.0'
}
```

2. Swagger 설정(`SwaggerConfig.java`)
```Java
@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http.authorizeHttpRequests(auth -> auth
        .requestMatchers("/api-docs/**", "/swagger-ui/**", "/swagger-ui.html").permitAll()
        .anyRequest().authenticated()
    );
    return http.build();
}
```

### 2. 게이트웨이 설정

**대상:** `API Gateway`
1. 의존성 추가(`build.gradle`)
```groovy
dependencies {
    implementation 'org.springdoc:springdoc-openapi-starter-webflux-ui:2.3.0'
}
```
2. 라우팅 및 통합 설정(`application.yml`)
```yml
spring:
  cloud:
    gateway:
      routes:
        # Service 문서 라우트
        - id: xxx-service-docs
          uri: lb://xxx-SERVICE
          predicates:
            - Path=/xxx-service/v3/api-docs
          filters:
            - RewritePath=/xxx-service/(?<segment>.*), /$\{segment}
        
        # Comment Service 문서 라우트
        - id: xxx-service-docs
          uri: lb://COMMENT-SERVICE
          predicates:
            - Path=/xxx-service/v3/api-docs
          filters:
            - RewritePath=/xxx-service/(?<segment>.*), /$\{segment}

# Swagger UI 통합 설정 (드롭다운 메뉴 생성)
springdoc:
  swagger-ui:
    urls:
      - name: xxx Service
        url: /xxx-service/v3/api-docs
      - name: xxx Service
        url: /xxx-service/v3/api-docs
    path: /swagger-ui.html
```