# 251219 TIL

## Redis 연결 안됨 trouble shooting

| No. | 주요 에러 로그 (Symptom) | 근본 원인 (Root Cause) | 해결책 (Solution) |
| :-- | :--- | :--- | :--- |
| 1 | `RedisCommandTimeoutException: Connection initialization timed out` | AWS ElastiCache는 **SSL(TLS) 접속**을 강제하지만, `RedisConfig`에서 수동 생성한 Bean이 SSL 설정을 누락함. (YAML 설정 무시됨) | `RedisConfig.java`에서 `LettuceClientConfiguration` 빌더를 사용해 **`.useSsl()`** 옵션 추가. |

### 원인
- ElastiCache Encryption(TLS/SSL) : AWS 관리형 Redis는 기본적으로 보안을 위해 암호화된 연결만 허용. 클라이언트(Spring Boot)가 일반 텍스트로 통신을 시도하면 핸드쉐이크 과정 없이 연결이 타임아웃
- Manual Bean Override : Spring Boot는 application.yml 설정을 기반으로 빈을 자동 생성하지만, 개발자가 @Bean을 직접 선언하면 자동 설정은 취소. 따라서 수동 설정 코드(RedisConfig.java)에 SSL 옵션을 명시적으로 넣어야 함

### 해결방법
- Redis Config 수정 (SSL 활성화)
```Java
    @Bean
    public RedisConnectionFactory redisConnectionFactory() {
        RedisStandaloneConfiguration redisConfig = new RedisStandaloneConfiguration();
        redisConfig.setHostName(host);
        redisConfig.setPort(port);

        LettuceClientConfiguration clientConfig = LettuceClientConfiguration.builder()
                .useSsl() 
                .build();

        return new LettuceConnectionFactory(redisConfig, clientConfig);
    }
```

