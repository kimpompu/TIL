# 251027 TIL

## Kafka
- 분산 이벤트 스트리밍 플랫폼(Distributed Event Streaming Platform)
- 대용량 처리량(High Throughput), 확장성(Scalability), 영속성(Durability), 실시간 스트림 처리

### Kafka 구성요소
- `Producer`: 메시지(이벤트)를 생성하여 Topic으로 전송하는 주체

- `Broker`: Kafka 서버. 데이터를 Topic과 Partition 단위로 저장하고 관리

- `Topic`: 데이터의 카테고리 또는 분류 단위. 데이터베이스의 테이블과 유사

- `Partition`: Topic의 물리적 분할 단위로, 메시지가 실제로 저장되는 곳이자 병렬 처리의 기본 단위. 파티션 내에서는 메시지가 순서대로 저장.

- `Offset`: 각 파티션 내에서 메시지의 고유한 위치(인덱스). Consumer는 이 Offset을 통해 어디까지 읽었는지 추적

- `Consumer`: Topic을 구독하고 메시지를 가져가 처리하는 주체. Consumer Group을 형성하여 파티션의 메시지를 병렬로 소비.

### Kafka 메세지 전달 방법
1. Producer가 메시지를 Topic(Partition) 에 기록

2. 메시지는 삭제되지 않고 디스크에 순서대로 저장 (append-only log)

3. Consumer는 각자 “어디까지 읽었는지(offset)”를 기억하고 그 이후부터 읽음

4. 여러 Consumer Group이 독립적으로 동일한 데이터 스트림을 읽을 수 있음

### RabbitMQ와 비교

| 구분 | RabbitMQ (전통적인 메시지 큐) | Apache Kafka (이벤트 스트리밍 플랫폼) |
| :--- | :--- | :--- |
| **주요 목적** | 복잡한 라우팅, 작업 큐, 신뢰할 수 있는 메시지 전달 | 대용량 로그/이벤트 스트림 처리, 데이터 파이프라인, 이벤트 소싱 |
| **아키텍처** | 메시지 브로커 (Broker 중심) | 분산 로그/스트리밍 플랫폼 (Log 중심) |
| **메시지 전달** | **Push 모델** (브로커가 컨슈머에게 푸시) | **Pull 모델** (컨슈머가 브로커에서 풀) |
| **메시지 보관** | 소비 후 즉시 삭제 (기본적으로 휘발성) | 설정된 기간 동안 **영구 보관** (영속성) |
| **처리량 (Throughput)** | 상대적으로 낮음 (초당 수만 건) | 상대적으로 **매우 높음** (초당 수십만 건 이상) |
| **확장성** | Queue 단위의 수평 확장 제약이 있을 수 있음 | Partition을 통한 수평 확장 용이 (Scale-Out 설계) |
| **메시지 라우팅** | Exchange-Binding-Queue 구조로 **매우 복잡하고 유연**한 라우팅 가능 | Topic-Partition 구조로 상대적으로 단순한 라우팅 |
| **소비자 수** | 일반적으로 하나의 메시지를 하나의 소비자만 소비 (**Point-to-Point**), Fanout은 가능 | 여러 Consumer Group이 동일한 메시지 스트림을 독립적으로 소비 가능 (**Pub/Sub**) |
| **메시지 순서** | Queue 내에서 순서 보장 (단일 소비자) | **Partition 내에서만 순서 보장** |

### 대용량 처리시 고려사항
| 구분            | RabbitMQ           | Kafka                |
| ------------- | --------------------- | ----------------------- |
| **핵심 목적**     | 안정적 메시지 전달 / 작업 처리    | 대규모 이벤트 스트리밍 / 로그 분석    |
| **데이터 소비 방식** | 한 소비자가 메시지를 꺼내면 삭제    | 여러 소비자가 동일 데이터 구독 가능    |
| **처리량**       | 중간 (TPS 수천~수만)        | 매우 높음 (TPS 수십만 이상)      |
| **지속성**       | 단기 보관 (소비 후 삭제)       | 장기 보관 (retention 기간 유지) |
| **적합 예시**     | 주문 처리, 이메일 발송, 비동기 작업 | 로그 수집, 이벤트 분석, 실시간 스트리밍 |
| **재처리**       | 불가 (삭제됨)              | 가능 (offset 조정)          |
| **트랜잭션 중요성**  | 높음                    | 중간 (대량 스트리밍 중심)         |
