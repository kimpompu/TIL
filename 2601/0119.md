# 260119 TIL

## 네트워크 기초 및 주소 체계

### TTL (Hop Limit) 정의
Time To Live (Hop Limit) : 패킷이 네트워크상에서 무한히 순환하는 것을 방지하기 위해 설정된 값임. 라우터를 거칠 때마다 1씩 감소하며, 0이 되면 패킷은 폐기되고 ICMP 시간 초과 메시지가 송신자에게 전달됨.

### IP 주소와 MAC 주소의 차이
* **IP Address :** 네트워크 계층(Layer 3)의 논리적 주소임. 목적지 네트워크를 찾아가는 라우팅에 사용되며 주소 변경이 가능함.
* **MAC Address :** 데이터 링크 계층(Layer 2)의 물리적 주소임. 인접한 장치 간 데이터를 전달할 때 사용되며 하드웨어 제조 시 할당되어 변경이 불가능함.

### OSI 7계층 개요
1. **Physical :** 비트 단위의 전기적 신호 전송.
2. **Data Link :** 인접 노드 간 신뢰성 있는 프레임 전송 및 물리 주소 결정.
3. **Network :** 최적 경로 결정(Routing) 및 논리 주소 부여.
4. **Transport :** 종단 간(End-to-End) 신뢰성 있는 데이터 전송 및 흐름 제어.
5. **Session :** 응용 프로세스 간의 세션 체결 및 동기화.
6. **Presentation :** 데이터 표현 방식 변환(암호화, 압축 등).
7. **Application :** 사용자 인터페이스 및 네트워크 서비스 제공.



[Image of OSI 7 layer model]


### Transport Layer와 Network Layer의 차이
* **Transport Layer :** 종단 시스템(End-to-End) 내의 프로세스 간 통신을 담당하며 신뢰성 및 흐름 제어를 수행함.
* **Network Layer :** 호스트 간(Host-to-Host)의 패킷 전달을 담당하며 최적의 경로를 탐색함.

### L3 Switch와 Router의 차이
* **Router :** 소프트웨어 기반의 라우팅 기능을 수행하며 다양한 인터페이스와 복잡한 라우팅 프로토콜을 지원함.
* **L3 Switch :** 하드웨어(ASIC) 기반으로 패킷을 처리하여 라우터보다 속도가 빠름. 주로 내부 네트워크(LAN) 간 라우팅에 최적화됨.

### 계층별 데이터 단위 (PDU) 명칭
* **Application Layer :** Message
* **Transport Layer :** Segment (TCP) / Datagram (UDP)
* **Network Layer :** Packet
* **Data Link Layer :** Frame
* **Physical Layer :** Bit

### Header Packing Order
Encapsulation 과정에 따라 상위 계층 데이터가 하위 계층의 Payload가 됨. 전송 시에는 `[L2 Header | L3 Header | L4 Header | Data | L2 Trailer]` 순서로 패킹됨.

### ARP (Address Resolution Protocol)
논리적인 IP 주소를 기반으로 물리적인 MAC 주소를 찾아내는 프로토콜임. 동일 네트워크 내에서 브로드캐스트를 통해 대상 호스트를 식별함.

---

## TCP 핸드셰이크 및 연결 관리

### 3-Way Handshake 과정
1. **SYN :** 클라이언트가 서버에 연결 요청(번호 할당).
2. **SYN + ACK :** 서버가 요청 수락 및 자신의 연결 요청 송신.
3. **ACK :** 클라이언트가 서버의 요청에 대해 최종 확인 응답함.



### 제어 정보 전달 방식 (ACK, SYN 등)
TCP 헤더 내의 **Control Bits (Flags)** 필드를 활용함. 특정 비트를 1로 설정하여 해당 메시지의 성격(SYN, ACK, FIN, RST 등)을 표시함.

### 2-Way Handshaking을 하지 않는 이유
양방향 통신의 신뢰성을 보장할 수 없기 때문임. 클라이언트가 보낸 SYN에 대한 서버의 응답(ACK)만으로는 클라이언트가 해당 응답을 제대로 받았는지 서버가 확인할 수 없어 시퀀스 번호 동기화가 불가능함.

### 동시 연결 시도 (Simultaneous Open)
두 호스트가 동시에 SYN을 보내도 연결 가능함. 각자 SYN을 보낸 후 상대의 SYN을 받으면 SYN+ACK를 보내고, 최종적으로 ACK를 교환하는 절차를 거쳐 하나의 연결을 수립함.

### SYN Flooding 공격
공격자가 다수의 SYN 요청만 보내고 서버의 SYN+ACK에 응답하지 않아 서버의 접속 대기 큐(Backlog Queue)를 가득 채우는 서비스 거부(DoS) 공격임.

### 0-RTT 기법 (TFO, TLS 1.3)
이전 연결 정보를 재사용하는 방식임. TCP Fast Open(TFO)이나 TLS 1.3에서는 이전에 교환한 암호화 키 정보를 저장했다가, 첫 번째 SYN 패킷에 데이터를 함께 실어 보내어 핸드셰이크 지연을 제거함.

### 4-Way Handshake 과정
1. **FIN :** 한쪽이 종료 의사 전달.
2. **ACK :** 상대방이 확인 응답 후 남은 데이터 전송 대기.
3. **FIN :** 상대방도 종료 준비 완료 후 종료 신호 송신.
4. **ACK :** 최초 송신자가 확인 응답함.

### 종료 패킷 식별 방법
TCP 헤더의 **FIN** 플래그 비트가 1로 설정된 것을 확인하여 종료 목적임을 파악함.

### 강제 종료 및 예외 처리
* **RST 패킷 :** 여유가 없거나 비정상적인 상황일 때 RST(Reset) 플래그를 담은 패킷을 보내 연결을 즉시 강제 종료함.
* **강제 종료 감지 :** 한쪽 네트워크가 끊기면 상대방은 Keep-alive 프로브를 보내거나 재전송 타이머 만료를 통해 연결 단절을 인식함.

### TIME_WAIT 상태의 존재 이유
1. **지연 패킷 처리 :** 이전 연결에서 발생한 지연 패킷이 뒤늦게 도착하여 다음 연결에 혼선을 주는 것을 방지함.
2. **마지막 ACK 보장 :** 마지막 ACK가 유실되었을 경우 서버가 다시 FIN을 보낼 수 있는데, 이를 처리하기 위해 일정 시간 대기함.

---

## 웹 통신 및 DNS

### github.com 접속 시나리오
1. **DNS Lookup :** 브라우저 캐시, 호스트 파일, DNS 서버 순으로 IP 주소 탐색.
2. **TCP/TLS Handshake :** IP 주소로 목적지 서버와 연결 수립 및 보안 세션 체결.
3. **HTTP Request :** 서버에 페이지 자원 요청.
4. **Server Processing :** 로드밸런서를 거쳐 웹 서버 및 WAS가 요청 처리.
5. **HTTP Response :** HTML, CSS, JS 데이터 응답.
6. **Rendering :** 브라우저가 데이터를 해석하여 화면 출력.

### DNS 쿼리 결과 IP의 지향점
일반적으로 서비스의 최전방에 위치한 **Load Balancer**나 **CDN(Content Delivery Network)**의 주소를 가리킴.

### Web Server와 WAS의 차이
* **Web Server :** 정적 컨텐츠(HTML, 이미지 등)를 처리하며 성능 최적화에 집중함. (예 : Nginx, Apache)
* **WAS :** DB 조회나 비즈니스 로직 등 동적 컨텐츠를 처리함. (예 : Tomcat, JBoss)

### URL, URI, URN 차이
* **URI (Identifier) :** 자원을 식별하는 가장 포괄적인 개념임.
* **URL (Locator) :** 자원의 위치(경로)를 통해 식별함.
* **URN (Name) :** 위치와 상관없이 독립적인 이름으로 자원을 식별함.

### DNS (Domain Name System) 상세
* **계층 :** 응용 계층(Application Layer)임.
* **프로토콜 :** 일반적으로 UDP 53번을 사용하나, 데이터가 512바이트를 초과하거나 존 전송 시에는 TCP 53번을 사용함.
* **Query 방식 :** * **Recursive :** 클라이언트가 서버에 결과를 끝까지 요구함.
    * **Iterative :** 서버가 다른 서버의 주소를 알려주며 클라이언트가 직접 단계별로 찾아감.
* **손실 처리 :** UDP의 비신뢰성으로 인해 클라이언트 측에서 타임아웃 발생 시 재전송을 수행함.
* **에러 보정 :** TTL(유효 기간) 만료를 기다리거나 관리자가 수동으로 캐시를 비워야 함.

### DNS 레코드 타입
* **A :** 도메인 이름을 IPv4 주소로 매핑함.
* **AAAA :** 도메인 이름을 IPv6 주소로 매핑함.
* **CNAME :** 도메인 이름을 다른 도메인 이름(별칭)으로 매핑함.

### hosts 파일
로컬 시스템에서 도메인과 IP 매핑 정보를 관리하는 텍스트 파일임. DNS 서버 조회보다 우선순위가 높음.

---

## 보안 및 정책

### SOP와 CORS
* **SOP (Same-Origin Policy) :** 동일한 출처에서만 자원을 공유할 수 있도록 하는 브라우저 보안 원칙임.
* **CORS (Cross-Origin Resource Sharing) :** 다른 출처의 자원에 접근할 수 있도록 허용하는 예외 정책임. 서버가 응답 헤더에 허용 범위를 설정함.

### Preflight 요청
CORS 상황에서 실제 요청 전 **OPTIONS** 메서드를 사용하여 서버가 해당 요청을 허용하는지 미리 확인하는 과정임.

### XSS와 CSRF 차이
* **XSS (Cross-Site Scripting) :** 사용자 브라우저에 악성 스크립트를 실행시켜 쿠키 등을 탈취함. 프론트엔드와 백엔드 모두에서 입력값 필터링 및 CSP 설정으로 방어해야 함.
* **CSRF (Cross-Site Request Forgery) :** 사용자의 의도와 상관없이 공격자가 의도한 행위(수정, 삭제 등)를 서버에 요청하게 함. 리퍼러 체크나 CSRF 토큰으로 방어함.

---

## HTTP 및 인프라

### Stateless와 Connectionless
* **Stateless :** 서버가 클라이언트의 이전 상태를 기억하지 않음. 확장성이 높음.
* **Connectionless :** 응답 후 연결을 끊어 자원을 반납함. 매번 핸드셰이크가 필요함.

### 성능 저하 해결 (Keep-alive)
* **HTTP Keep-alive :** 한 번 맺은 TCP 연결로 여러 개의 HTTP 요청을 전송하여 지연을 줄임.
* **TCP Keep-alive :** 연결이 유효한지 확인하기 위해 주기적으로 작은 패킷을 보냄.

### 라우팅과 포워딩
* **Routing :** 전체 네트워크 경로 중 최적의 경로를 결정하는 과정(제어 평면).
* **Forwarding :** 들어온 패킷을 적절한 출력 인터페이스로 이동시키는 과정(데이터 평면).

### 로드밸런싱 (L4 vs L7)
* **L4 :** IP 주소와 포트 번호를 기반으로 트래픽 분산. 속도가 빠름.
* **L7 :** URL, HTTP 헤더, 쿠키 등 애플리케이션 데이터를 기반으로 분산. 정교한 제어 가능.

### 헬스 체크 (Health Check)
로드밸런서가 서버의 상태를 주기적으로 확인하여 문제가 있는 서버를 서비스 대상에서 자동으로 제외함.

### DNS 로드밸런싱 (Round Robin DNS)
하나의 도메인에 여러 IP를 등록하여 DNS 조회 시 순차적으로 IP를 반환함으로써 부하를 분산함.

### 서브넷 마스크 및 NAT
* **Subnet Mask :** IP 주소에서 네트워크 부분과 호스트 부분을 구분함. 255.0.255.0 같은 불연속적인 마스크는 논리적으로 마스킹이 가능하나 표준 CIDR 체계에서는 허용되지 않음.
* **NAT (Network Address Translation) :** 사설 IP를 공인 IP로 변환하여 주소 부족 문제를 해결하고 보안을 강화함.

### 멀티플렉싱 및 디멀티플렉싱
* **Multiplexing :** 여러 소켓의 데이터를 모아 전송 계층 헤더를 붙여 하위 계층으로 보내는 과정임.
* **Demultiplexing :** 수신된 세그먼트의 포트 번호를 확인하여 적절한 소켓으로 전달하는 과정임.