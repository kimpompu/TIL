# 260125 TIL

## WebSocket의 기본 개념과 HTTP와의 차이점은 무엇인가요?
* **기본 개념** : TCP 연결 위에서 전이중(Full-duplex) 통신 채널을 제공하는 프로토콜임
* **차이점** : HTTP는 무상태성(Stateless) 요청-응답 방식이나, WebSocket은 한 번 연결되면 상태를 유지하며 양방향 통신이 가능함
* **오버헤드** : HTTP는 매 요청마다 헤더를 포함하지만 WebSocket은 연결 수립 후 프레임 단위로 데이터를 주고받아 통신 부하가 매우 적음

## WebSocket 연결의 Handshake 과정은 어떻게 진행되나요?

1. **클라이언트 요청** : `Upgrade: websocket`, `Connection: Upgrade`, `Sec-WebSocket-Key` 헤더를 포함한 HTTP GET 요청을 보냄
2. **서버 응답** : 서버는 `101 Switching Protocols` 응답과 함께 키 값을 가공한 `Sec-WebSocket-Accept` 헤더를 반환함
3. **프로토콜 전환** : 이후 HTTP 프로토콜에서 WebSocket 프로토콜로 전환되어 데이터 프레임 전송이 시작됨

## WebSocket의 메시지 프레이밍(message framing) 메커니즘에 대해 설명해주세요.

* **구조** : 데이터를 전송할 때 최소 2바이트에서 최대 14바이트의 헤더를 가진 '프레임' 단위로 쪼개어 전송함
* **구성 요소** : FIN 비트(메시지 종료 여부), Opcode(데이터 타입), Masking 비트, Payload length 등으로 구성됨
* **마스킹(Masking)** : 클라이언트에서 서버로 보내는 모든 프레임은 보안을 위해 마스킹 처리가 필수적임

## Long Polling과 WebSocket의 차이점은 무엇인가요?
* **Long Polling** : HTTP 연결을 유지하다 데이터 발생 시 응답하고 연결을 종료하는 방식이며 사실상 단방향 응답 대기 형태임
* **WebSocket** : TCP 기반의 지속적인 연결을 통해 실시간 양방향 통신을 지원하며 반복적인 재연결 오버헤드가 없음

## WebSocket 통신에서 보안을 강화하기 위한 주요 고려 사항은 무엇인가요?
* **WSS 사용** : TLS/SSL 암호화가 적용된 `wss://` 프로토콜을 필수로 사용하여 스니핑 및 변조를 방지함
* **Origin 검사** : 서버 측에서 `Origin` 헤더를 검증하여 허가되지 않은 사이트에서의 연결(CSWSH 공격)을 차단함
* **인증 및 인가** : Handshake 시 쿼리 파라미터나 전용 티켓 기반 인증을 수행하여 표준 HTTP 인증의 어려움을 보완함

## WebSocket 연결이 끊어졌을 때 재연결(reconnect) 로직은 어떻게 구현하나요?
* **지수 백오프(Exponential Backoff)** : 연결 실패 시 즉시 재시도하지 않고 대기 시간을 점진적으로 늘려 서버 부하를 방지함
* **상태 관리** : 클라이언트 애플리케이션 레벨에서 연결 상태를 추적하고 재연결 시 누락된 데이터를 복구하는 로직을 포함함

## WebSocket 프로토콜에서 사용되는 상태 코드와 그 의미에 대해 설명해주세요.
* **1000** : 정상 종료(Normal Closure)
* **1001** : 서버 중단 혹은 브라우저 이동으로 인한 이탈(Going Away)
* **1006** : 비정상 종료(Abnormal Closure, 연결 유실 등)
* **1009** : 메시지 크기 초과로 인한 처리 불가

## Ping/Pong 메커니즘이 WebSocket 연결 유지에 어떻게 활용되는지 설명해주세요.
* **목적** : 연결이 여전히 유효한지 확인하는 '하트비트' 역할을 수행함
* **동작** : 서버나 클라이언트가 Ping 프레임을 보내면 상대방은 즉시 Pong 프레임으로 응답해야 하며 응답이 없으면 연결을 끊음

## WebSocket 확장(extensions) 기능은 무엇이며, 어떤 용도로 사용되나요?
* **정의** : 프로토콜의 기본 기능 외에 추가적인 기능을 협상하기 위한 메커니즘임
* **용도** : `permessage-deflate`와 같은 확장 기능을 통해 데이터 압축을 수행하여 네트워크 대역폭 효율을 높이는 데 사용됨

## WebSocket 구현 시 발생할 수 있는 Cross-Origin 문제와 그 해결 방법은 무엇인가요?
* **문제점** : 브라우저의 SOP가 WebSocket에 직접 적용되지 않아 모든 도메인에서 연결이 가능해지는 보안 취약점이 발생함
* **해결 방법** : 서버 측에서 `Origin` 헤더를 화이트리스트와 대조하여 검증하는 로직을 구현함

## 단일 서버와 클러스터 환경에서의 WebSocket 구현 차이점은 무엇인가요?
* **문제점** : 클러스터 환경에서는 클라이언트들이 서로 다른 서버 노드에 연결되어 있어 노드 간 직접 통신이 불가능함
* **해결 방법** : Redis Pub/Sub이나 Kafka 같은 메시지 브로커를 중간에 두어 모든 노드가 메시지를 공유하도록 구성함

## WebSocket에서 텍스트와 이진 데이터 전송 방식의 장단점은 무엇인가요?
* **텍스트(UTF-8)** : JSON 등을 주고받기 편리하며 디버깅이 쉬우나 데이터 크기가 상대적으로 큼
* **이진(Binary)** : 프로토콜 버퍼 등을 사용하여 데이터 크기를 최소화할 수 있어 성능에 유리하지만 파싱 로직이 복잡함

## 실시간 채팅이나 게임 애플리케이션에서 WebSocket이 선호되는 이유는 무엇인가요?
* **이유** : 낮은 지연 시간으로 양방향 통신이 가능하며 스트리밍 및 실시간 데이터 푸시에 최적화되어 상호작용 피드백이 빠르기 때문임

## WebSocket 서버의 부하 분산(load balancing) 전략에는 어떤 것들이 있나요?
* **L4/L7 스위치** : 로드밸런서가 WebSocket 프로토콜(Upgrade 헤더)을 지원해야 함
* **Sticky Session** : 동일한 클라이언트는 동일한 서버 노드로 유지되도록 설정하여 세션 정합성을 보장함

## WebSocket 연결 유지 시 메모리 및 리소스 관리 방법은 무엇인가요?
* **연결 제한** : 파일 디스크립터(File Descriptor) 한계 설정을 높여 다수의 동시 연결을 수용함
* **Idle Timeout** : 장시간 활동이 없는 커넥션을 주기적으로 정리하여 메모리 누수를 방지함

## WebSocket과 HTTP/2의 주요 차이점은 무엇인가요?
* **HTTP/2** : 하나의 연결로 여러 요청을 동시에 처리(Multiplexing)하는 데 최적화되어 있으나 서버 푸시는 제한적임
* **WebSocket** : 실시간 양방향 통신에 완전히 특화되어 있어 지속적인 데이터 스트리밍에 더 유리함


## WebSocket 연결의 성능 최적화를 위한 고려사항은 무엇인가요?
* 메시지 크기 최소화 및 압축 적용, 불필요한 직렬화 비용 감소, 논블로킹 I/O 기반 서버 엔진 사용 등이 필요함

## WebSocket 서버 구축 시 장애 조치(failover) 방안을 어떻게 마련할 수 있나요?
* 로드밸런서를 통한 서버 상태 체크(Health Check)와 클라이언트 측의 자동 재연결 로직을 결합하여 가용성을 확보함

## 클라이언트에서 WebSocket 연결 오류를 디버깅하는 방법에는 어떤 것들이 있나요?
* 브라우저 개발자 도구의 Network 탭에서 WebSocket 프레임 로그를 확인하거나 onerror/onclose 핸들러를 통해 상태 코드를 분석함

## WebSocket과 서버 푸시(Server-Sent Events)의 차이점은 무엇인가요?
* **SSE** : HTTP 기반의 단방향(서버->클라이언트) 텍스트 스트리밍 방식임
* **WebSocket** : TCP 기반의 양방향 전이중 통신 방식으로 텍스트와 이진 데이터를 모두 지원함

## TLS/SSL을 활용하여 WebSocket 연결을 보호하는 방법에 대해 설명해주세요.
* 인증서가 설치된 도메인을 통해 `wss://` 프로토콜로 연결하여 종단간 암호화를 수행하고 중간자 공격을 방지함

## WebSocket 통신에서 프록시 서버 사용 시 발생할 수 있는 문제는 무엇인가요?
* 구형 프록시가 `Upgrade` 헤더를 인식하지 못해 연결을 차단하거나 데이터 버퍼링으로 인해 실시간성이 저하될 수 있음

## WebSocket 라이브러리(예: Socket.IO, ws 등)의 차이점과 선택 기준에 대해 설명해주세요.
* **ws** : 표준 프로토콜의 최소 기능을 구현한 가벼운 라이브러리로 순수 성능이 중요할 때 선택함
* **Socket.IO** : 자동 재연결, 룸(Room) 개념, 폴링 폴백 등 부가 기능을 제공하는 프레임워크로 생산성이 중요할 때 선택함

## WebSocket을 활용한 Pub/Sub 시스템 구현 방법에 대해 설명해주세요.

* 클라이언트를 특정 채널에 구독시키고 서버 노드 간 메시지 브로커(Redis 등)를 연동하여 이벤트를 브로드캐스팅함

## WebSocket 연결 종료 시 graceful shutdown을 구현하는 방법은 무엇인가요?
* 서버 종료 시 새로운 연결을 차단하고 기존 연결들에 종료 상태 코드를 보낸 뒤 일정 시간 대기 후 소켓을 닫음

## WebSocket의 버전 관리 및 프로토콜 업데이트가 필요한 이유는 무엇인가요?
* 메시지 스키마 변경에 따른 하위 호환성을 유지하고 보안 취약점 대응 및 통신 효율 개선을 위해 필요함

## WebSocket 통신에서 데이터 압축 기능을 사용할 때 고려해야 할 점은 무엇인가요?
* 압축/해제 과정에서 발생하는 CPU 연산 부하와 실제 대역폭 절감 이득 사이의 트레이드오프를 평가해야 함

## WebSocket 연결 시 세션 관리를 구현하는 방법에는 어떤 것들이 있나요?
* Handshake 시점에 세션 쿠키를 검증하거나 연결된 소켓 객체에 사용자 식별 정보를 매핑하여 유지함

## WebSocket 서버와 클라이언트 간의 인증 및 인가 방식은 어떻게 구현하나요?
* 연결 수립 시 JWT 토큰을 검증하거나 별도의 인증 메시지 교환 절차를 통해 권한을 확인한 후 통신을 허용함

## WebSocket 기반 애플리케이션에서 발생할 수 있는 일반적인 문제와 해결 방안은 무엇인가요?
* 좀비 커넥션 문제는 하트비트(Ping/Pong)로 해결하며 서버 부하 문제는 샤딩 및 클러스터링을 통해 대응함