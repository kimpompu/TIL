# 251113 TIL

## 인증 (Authentication)
- 사용자가 ID/PW로 로그인하여 자신이 누구인지 증명

## 인가 (Authorization)
- 인증된 사용자가 특정 리소스에 접근할 권한이 있는지 확인

### GatewayAuthenticationFilter
- 게이트웨이로 HTTP 요청을 보낼 때, 하위 서비스로 라우팅되기 **(Pre-Filter)**에 실행
- JWT 검증
- 요청 변조 (Header Injection): 토큰이 유효하면, 토큰에서 **사용자 정보(ID, Role, 이름 등)**를 추출해 신뢰할 수 있는 새로운 헤더에 담아 하위 서비스로 보낼 요청에 주입
- 모든 하위 서비스는 토큰 검증 책임을 게이트웨이에 위임
- 하위 서비스는 게이트웨이로부터 받은 X-User-Id 헤더를 신뢰하고, 누가 요청했는지를 식별 비즈니스 로직을 처리
- User > Gateway (토큰 검증, X-User-Id 주입) > OrderService

### RequestInterceptor
- 인증 토큰 전파 (Authentication Propagation)
- 컨텍스트 접근: RequestContextHolder를 통해 service가 게이트웨이로부터 받은 원본 HTTP 요청에 접근
- 헤더 복사 (Propagation): 원본 요청 헤더에 있던 Authorization: Bearer <Token> 값을 복사
- Feign 요청에 헤더 주입: 다른 service로 보낼 새로운 Feign 요청의 헤더에 원본 Authorization 헤더를 그대로 복사하여 주입

| 구분 | `GatewayAuthenticationFilter` (in Gateway) | `FeignAuthConfiguration` (in service) |
| :--- | :--- | :--- |
| **목적** | **인증 및 신원 확인** (Authentication) | **인증 전파** (Propagation) |
| **작동 방식** | `GlobalFilter` (Reactive) | `RequestInterceptor` (Servlet) |
| **주요 대상** | **외부 $\rightarrow$ 내부** (User $\rightarrow$ Gateway) | **내부 $\rightarrow$ 내부** (OrderService $\rightarrow$ ItemService) |
| **핵심 동작** | 토큰을 **검증**하고, **`X-User-Id`**를 **주입**함 | 원본 `Authorization` 토큰을 **복사**하여 **전파**함 |